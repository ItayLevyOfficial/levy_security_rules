service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {

      function validName(name) {
        return name is string &&
          name.size() > 0 &&
          name.size() < 50;
      } 
      
      allow create, update: if 
       request.resource.data.phone_number == request.auth.token.phone_number &&
       validName(request.resource.data.name);

      allow delete: if request.auth.token.phone_number == resource.data.phone_number;
      allow read: if request.auth.token.phone_number == resource.data.phone_number;
    }
  }
}
